<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head">
    <meta charset="UTF-8">
    <title>My Account</title>
</head>
<body>
    <!-- Header -->
    <div th:replace="fragments/header :: header"></div>

    <!-- Account Section -->
    <div class="container py-5">
        <div class="row">
            <!-- Sidebar Navigation - Simplified -->
            <div class="col-lg-3 mb-4">
                <div class="card border-0 shadow-sm rounded">
                    <div class="card-header bg-dark text-white py-3">
                        <h5 class="mb-0">My Account</h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#" class="list-group-item list-group-item-action active">
                            <i class="fas fa-home me-2"></i> Account Overview
                        </a>
                        <a th:href="@{/user/profile}" class="list-group-item list-group-item-action">
                            <i class="fas fa-user me-2"></i> My Profile
                        </a>
                        <a th:href="@{/cart/view}" class="list-group-item list-group-item-action">
                            <i class="fas fa-shopping-cart me-2"></i> My Cart
                        </a>
                        <a th:href="@{/user/logout}" class="list-group-item list-group-item-action text-danger">
                            <i class="fas fa-sign-out-alt me-2"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-dark text-white py-3">
                        <h4 class="mb-0">Account Overview</h4>
                    </div>
                    <div class="card-body p-4">
                        <!-- Success and Error Messages -->
                        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show mb-4" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            <span th:text="${successMessage}">Password changed successfully!</span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            <span th:text="${errorMessage}">An error occurred!</span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        
                        <div class="row">
                            <!-- Welcome Section -->
                            <div class="col-md-12 mb-4">
                                <div class="bg-light p-4 rounded">
                                    <div class="d-flex align-items-center">
                                        <div class="me-4">
                                            <i class="fas fa-user-circle fa-4x text-primary"></i>
                                        </div>
                                        <div>
                                            <h3 class="mb-2">Welcome back, <span th:text="${user.username}" class="text-primary">username</span>!</h3>
                                            <p class="text-muted mb-0">Thanks for being a valued customer.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Account Info Summary -->
                            <div class="col-md-6 mb-4">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">
                                            <i class="fas fa-user-tag me-2 text-primary"></i>
                                            Account Information
                                        </h5>
                                        <div class="mb-2">
                                            <span class="text-muted">Username:</span>
                                            <span class="fw-bold ms-2" th:text="${user.username}">username</span>
                                        </div>
                                        <div class="mb-2">
                                            <span class="text-muted">Email:</span>
                                            <span class="fw-bold ms-2" th:text="${user.email ?: 'Not set'}">email@example.com</span>
                                        </div>
                                        <div class="mb-2">
                                            <span class="text-muted">Gender:</span>
                                            <span class="fw-bold ms-2" th:text="${user.gender ?: 'Not set'}">Not set</span>
                                            <button class="btn btn-sm btn-link text-primary" data-bs-toggle="modal" data-bs-target="#genderModal">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                        <a th:href="@{/user/profile}" class="btn btn-sm btn-outline-primary mt-3">
                                            <i class="fas fa-edit me-1"></i> Edit Profile
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recent Activity & Stats -->
                            <div class="col-md-6 mb-4">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">
                                            <i class="fas fa-shield-alt me-2 text-primary"></i>
                                            Account Security
                                        </h5>
                                        <div class="mb-2">
                                            <span class="text-muted">Last Login:</span>
                                            <span class="fw-bold ms-2" th:text="${#dates.format(#dates.createNow(), 'dd MMM yyyy')}">01 Jan 2023</span>
                                        </div>
                                        <div class="mb-2">
                                            <span class="text-muted">Password:</span>
                                            <span class="fw-bold ms-2">••••••••</span>
                                        </div>
                                        <a href="#" class="btn btn-sm btn-outline-primary mt-3" data-bs-toggle="modal" data-bs-target="#passwordConfirmModal">
                                            <i class="fas fa-lock me-1"></i> Manage Security
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Shopping Stats -->
                            <div class="col-md-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body">
                                        <h5 class="card-title mb-4">
                                            <i class="fas fa-shopping-bag me-2 text-primary"></i>
                                            Shopping Dashboard
                                        </h5>
                                        <div class="row text-center">
                                            <div class="col-md-4 mb-3 mb-md-0">
                                                <div class="p-3 bg-light rounded">
                                                    <div class="display-4 fw-bold text-primary">0</div>
                                                    <div class="text-muted">Items in Cart</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-3 mb-md-0">
                                                <div class="p-3 bg-light rounded">
                                                    <div class="display-4 fw-bold text-primary">0</div>
                                                    <div class="text-muted">Completed Orders</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="p-3 bg-light rounded">
                                                    <div class="display-4 fw-bold text-primary">0</div>
                                                    <div class="text-muted">Items Saved</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-4">
                                            <a th:href="@{/}" class="btn btn-primary px-4">
                                                <i class="fas fa-shopping-basket me-2"></i> Start Shopping
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <!-- Scripts -->
    <div th:replace="fragments/header :: scripts"></div>
    
    <!-- Password Management JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get elements
            const changePasswordForm = document.getElementById('changePasswordForm');
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const passwordMismatch = document.getElementById('passwordMismatch');
            const savePasswordBtn = document.getElementById('savePasswordBtn');
            
            // Check if passwords match when typing
            function checkPasswordMatch() {
                if (confirmPasswordInput.value && newPasswordInput.value !== confirmPasswordInput.value) {
                    passwordMismatch.classList.remove('d-none');
                    savePasswordBtn.disabled = true;
                } else {
                    passwordMismatch.classList.add('d-none');
                    savePasswordBtn.disabled = false;
                }
            }
            
            // Add event listeners
            if (newPasswordInput && confirmPasswordInput) {
                newPasswordInput.addEventListener('input', checkPasswordMatch);
                confirmPasswordInput.addEventListener('input', checkPasswordMatch);
            }
            
            // Validate form before submission
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', function(event) {
                    if (newPasswordInput.value !== confirmPasswordInput.value) {
                        event.preventDefault();
                        passwordMismatch.classList.remove('d-none');
                        return false;
                    }
                    
                    if (newPasswordInput.value.length < 4) {
                        event.preventDefault();
                        alert('Password must be at least 4 characters long');
                        return false;
                    }
                    
                    return true;
                });
            }
            
            // Handle modal chaining
            const passwordConfirmModal = document.getElementById('passwordConfirmModal');
            if (passwordConfirmModal) {
                passwordConfirmModal.addEventListener('hidden.bs.modal', function() {
                    // Reset form when modal is closed
                    if (changePasswordForm) {
                        changePasswordForm.reset();
                        passwordMismatch.classList.add('d-none');
                        savePasswordBtn.disabled = false;
                    }
                });
            }
        });
    </script>
    
    <!-- Password Confirmation Modal -->
    <div class="modal fade" id="passwordConfirmModal" tabindex="-1" aria-labelledby="passwordConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title" id="passwordConfirmModalLabel">
                        <i class="fas fa-shield-alt text-primary me-2"></i>
                        Account Security
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Current Password:</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="currentPassword" value="********" readonly>
                        </div>
                    </div>
                    <p>Would you like to change your password?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary" id="changePasswordBtn" data-bs-toggle="modal" data-bs-target="#changePasswordModal" data-bs-dismiss="modal">Yes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title" id="changePasswordModalLabel">
                        <i class="fas fa-key text-primary me-2"></i>
                        Change Password
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="changePasswordForm" th:action="@{/user/change-password}" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                            <div id="passwordMismatch" class="text-danger mt-1 d-none">
                                Passwords do not match
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="savePasswordBtn">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Gender Preference Modal -->
    <div class="modal fade" id="genderModal" tabindex="-1" aria-labelledby="genderModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title" id="genderModalLabel">
                        <i class="fas fa-venus-mars text-primary me-2"></i>
                        Update Gender Preference
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form th:action="@{/user/update-gender}" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="gender" class="form-label">Select your gender preference:</label>
                            <select class="form-select" id="gender" name="gender">
                                <option value="">Select gender</option>
                                <option value="Male" th:selected="${user.gender == 'Male'}">Male</option>
                                <option value="Female" th:selected="${user.gender == 'Female'}">Female</option>
                                <option value="Other" th:selected="${user.gender == 'Other'}">Other</option>
                                <option value="Prefer not to say" th:selected="${user.gender == 'Prefer not to say'}">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html> 