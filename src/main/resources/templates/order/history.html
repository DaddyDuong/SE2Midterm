<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head">
    <meta charset="UTF-8">
    <title>Order History</title>
</head>
<body class="d-flex flex-column min-vh-100">
    <!-- Header -->
    <div th:replace="fragments/header :: header"></div>

    <!-- Toast Messages -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true" id="errorToast" th:if="${error}">
            <div class="d-flex">
                <div class="toast-body" th:text="${error}">
                    Error message here
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
        
        <!-- Success Toast -->
        <div class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true" id="successToast" th:if="${success}">
            <div class="d-flex">
                <div class="toast-body" th:text="${success}">
                    Success message here
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow-1">
        <!-- Page Header -->
        <div class="bg-light py-5">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h1 class="fw-bold mb-0">My Order History</h1>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a th:href="@{/}" class="text-decoration-none">Home</a></li>
                                <li class="breadcrumb-item"><a th:href="@{/user/account}" class="text-decoration-none">My Account</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Order History</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order History Content -->
        <div class="container py-5">
            <!-- Alert for no orders -->
            <div class="alert alert-info" th:if="${orders.empty}">
                <i class="fas fa-info-circle me-2"></i>
                You haven't placed any orders yet. <a th:href="@{/products}" class="alert-link">Browse our products</a> to get started!
            </div>

            <!-- Order History Table -->
            <div class="card border-0 shadow-sm mb-4" th:unless="${orders.empty}">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="mb-0">
                        <i class="fas fa-history me-2"></i>
                        Order History
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Order #</th>
                                    <th>Date</th>
                                    <th>Items</th>
                                    <th>Shipping Address</th>
                                    <th>Status</th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="order : ${orders}">
                                    <td>
                                        <span class="fw-bold" th:text="${'#' + orderIndexMap.get(order.id)}">Order #1</span>
                                    </td>
                                    <td th:text="${#temporals.format(order.createdAt, 'dd-MM-yyyy HH:mm')}">01-01-2023</td>
                                    <td th:text="${order.orderItems.size() + ' item(s)'}">3 items</td>
                                    <td>
                                        <span th:text="${order.shippingCity + ', ' + order.shippingCountry}">City, Country</span>
                                    </td>
                                    <td>
                                        <span class="badge rounded-pill" 
                                              th:classappend="${order.status == 'PENDING' ? 'bg-warning' : 
                                                            (order.status == 'PAID' ? 'bg-success' : 
                                                            (order.status == 'SHIPPED' ? 'bg-info' : 
                                                            (order.status == 'DELIVERED' ? 'bg-primary' : 
                                                            (order.status == 'CANCELED' ? 'bg-danger' : 'bg-secondary'))))}">
                                            <span th:text="${order.status}">Status</span>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="fw-bold" th:text="${'$' + #numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 2, 'POINT')}">$99.99</span>
                                    </td>
                                    <td>
                                        <a th:href="@{'/orders/detail/' + ${order.id}}" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i> View Details
                                        </a>
                                        <a th:href="@{'/orders/delete/' + ${order.id}}" 
                                        class="btn btn-sm btn-outline-danger ms-1"
                                        onclick="return confirm('Are you sure you want to delete this order? This action cannot be undone.')">
                                            <i class="fas fa-trash"></i> Delete
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Continue Shopping Button -->
            <div class="text-center mt-4">
                <a th:href="@{/products}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i> Continue Shopping
                </a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <!-- Bootstrap JS and other scripts -->
    <div th:replace="fragments/header :: scripts"></div>
    
    <style>
        /* iPad Air specific adjustments */
        @media (min-width: 768px) and (max-width: 834px) {
            /* Make table easier to read on iPad */
            .table th, .table td {
                padding: 12px 15px;
                font-size: 16px;
            }
            
            /* Make buttons more tappable */
            .btn-sm {
                padding: 0.45rem 0.8rem;
                font-size: 0.95rem;
            }
            
            /* Make badge bigger */
            .badge {
                font-size: 0.9rem;
                padding: 0.5em 0.8em;
            }
            
            /* Add more space in general */
            .container {
                padding: 0 25px;
            }
            
            /* Larger section padding */
            .py-5 {
                padding-top: 3rem !important;
                padding-bottom: 3rem !important;
            }
            
            /* Larger text in breadcrumb */
            .breadcrumb {
                font-size: 1rem;
            }
            
            /* Make card body padding larger */
            .card-body {
                padding: 1.5rem !important;
            }
            
            /* Larger card header */
            .card-header h5 {
                font-size: 1.3rem;
            }
        }
    </style>
    
    <script>
        // Initialize toasts
        document.addEventListener('DOMContentLoaded', function() {
            var errorToast = document.getElementById('errorToast');
            if (errorToast) {
                var toast = new bootstrap.Toast(errorToast);
                toast.show();
            }
            
            var successToast = document.getElementById('successToast');
            if (successToast) {
                var toast = new bootstrap.Toast(successToast);
                toast.show();
            }
            
            // Ensure content fills the screen
            function adjustLayout() {
                const viewportHeight = window.innerHeight;
                const body = document.body;
                const main = document.querySelector('main');
                const footer = document.querySelector('footer');
                
                if (main && footer) {
                    const mainHeight = main.offsetHeight;
                    const headerHeight = main.offsetTop;
                    const footerHeight = footer.offsetHeight;
                    const minMainHeight = viewportHeight - headerHeight - footerHeight;
                    
                    if (mainHeight < minMainHeight) {
                        main.style.minHeight = minMainHeight + 'px';
                    }
                }
            }
            
            // Adjust on load and resize
            adjustLayout();
            window.addEventListener('resize', adjustLayout);
            window.addEventListener('load', adjustLayout);
        });
    </script>
</body>
</html> 